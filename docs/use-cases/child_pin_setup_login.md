# Child PIN Setup & Login

## Назначение
Описывает, как ребёнок:
- задаёт PIN после первого входа по invite-коду
- входит в приложение при последующих запусках
- восстанавливает доступ при утере PIN

PIN — основной способ авторизации ребёнка после первичной привязки устройства.

---

## Preconditions
- Child уже вошёл в приложение по invite-коду
- Устройство привязано к `childId`
- Пользовательская роль: `CHILD`

---

## UC-CHILD-AUTH-02: Setup PIN (первый вход)

### Триггер
Первый успешный логин ребёнка по invite-коду.

---

### Шаги

#### 1. Экран «Придумай код»

UI:
- Заголовок: «Придумай код»
- Подсказка: «Этот код нужен для входа в приложение»
- Ввод PIN (4 или 6 цифр)

---

#### 2. Подтверждение PIN

UI:
- Заголовок: «Повтори код»
- Повторный ввод PIN

Validation:
- PINы совпадают

---

#### 3. Отправка PIN

```http
POST /auth/child/set-pin
```
```json
{
  "pin": "1234"
}
```

Backend:
- хеширует PIN
- сохраняет `pinHash` у Child

---

#### 4. Завершение

- PIN сохранён
- ребёнок считается полностью авторизованным

```text
Setup PIN → Welcome → Child Home
```

---

## UC-CHILD-AUTH-03: Login by PIN (повторный вход)

### Триггер
- повторный запуск приложения
- refresh token истёк

---

### Шаги

#### 1. Определение устройства

Backend:
- по `deviceId` определяет `childId`

---

#### 2. Экран ввода PIN

UI:
- Заголовок: «Введи свой код»
- Ввод PIN
- Кнопка: «Я забыл код»

---

#### 3. Проверка PIN

```http
POST /auth/child/login-by-pin
```
```json
{
  "pin": "1234",
  "deviceId": "uuid-device"
}
```

Backend:
- сверяет `pinHash`
- создаёт сессию

---

#### 4. Успешный вход

```text
PIN OK → Welcome → Child Home
```

---

## UC-CHILD-AUTH-04: Forgot PIN

### Триггер
Ребёнок нажимает «Я забыл код»

---

### Поведение

- приложение блокирует вход
- показывает сообщение:
  > Попроси родителя помочь

---

### Recovery Flow

1. Родитель в parent app:
   - открывает профиль ребёнка
   - нажимает «Сбросить код»

2. Backend:
   - удаляет `pinHash`
   - отзывает refresh tokens

3. Ребёнок:
   - повторно проходит setup PIN

---

## Security Rules

- PIN хранится только в виде хеша
- лимит попыток (например, 5)
- временная блокировка при превышении
- PIN никогда не показывается родителю

---

## UX Notes

- минимальный текст
- дружелюбные формулировки
- визуальные индикаторы ввода

---

## Связанные Use Cases

- Child Login by Code
- Welcome Screen (Post-Login Splash)
- Parent Revoke Child Device

---

## Статус
✔ Зафиксировано

