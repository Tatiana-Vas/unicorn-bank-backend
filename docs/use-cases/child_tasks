# Child Tasks — Functional Specification (Child Side)

## Scope
Документ описывает поведение экрана **Child Tasks** и пользовательские сценарии со стороны ребенка.

Экран предназначен для:
- выполнения задач
- отказа от задач
- отправки выполненных задач на одобрение родителю
- просмотра истории выполненных и отклонённых задач

Вне scope:
- создание задач родителем
- процесс одобрения со стороны родителя
- начисление денег

---

## Core Concepts

### Task
Задание, созданное родителем.

**Атрибуты:**
- id
- title
- description (optional)
- rewardAmount
- scheduleType: `today | anytime | repeat`
- createdAt

---

### TaskInstance
Экземпляр задания для конкретной даты (используется для repeat).

**Атрибуты:**
- id
- taskId
- date
- status:
  - `active`
  - `under_review`
  - `done`
  - `declined`
  - `auto_declined`
  - `parent_declined`
- completedAt (optional)

---

## Tabs Overview

### Today
Отображает **только новые, ещё не выполненные задачи**:
- задачи с датой = сегодня
- задачи с типом `anytime`, если они ещё не выполнены

**Не отображаются:**
- выполненные задачи
- отклонённые задачи
- просроченные задачи
- будущие repeat-задачи

---

### Anytime
Список задач с расписанием **anytime**, которые ещё **не выполнены**.

**Отображение в карточке:**
- показывается **время создания задачи**

После любого решения (Done / I can’t / auto-decline):
- задача исчезает из вкладки Anytime

---

### Repeats
Список **TaskInstance** для repeat-задач:
- сегодняшние
- будущие

**Правила:**
- сегодняшние:
  - дата подсвечена **красным**
  - доступны для выполнения
- будущие:
  - недоступны для выполнения
  - доступны только для просмотра

> Истории повторяющихся задач как отдельной вкладки **не существует**

---

### Review
Содержит **только задачи, выполненные ребёнком и отправленные родителю на одобрение**.

**Сюда попадают:**
- TaskInstance со статусом `under_review`

**Не попадают:**
- отклонённые ребёнком задачи
- просроченные задачи
- запросы на создание новых задач

---

### History
История всех завершённых задач, **которые больше не требуют действий**.

**Статусы:**
- `done` — одобрена родителем
- `declined` — отклонена ребёнком
- `auto_declined` — просрочена (не выполнена в нужную дату)
- `parent_declined` — выполнена ребёнком, но отклонена родителем

---

## Task Card States

- **New** — доступна для выполнения (`active`)
- **Under review** — выполнена ребёнком, ожидает родителя
- **Done** — одобрена родителем
- **Declined** — отклонена ребёнком
- **Auto-declined** — не выполнена в нужную дату
- **Parent-declined** — отклонена родителем на этапе апрува

---

## Use Cases

---

### UC-CHILD-TASK-01: Mark task as done

**Description:**  
Ребёнок отмечает задачу как выполненную.

**Flow:**
1. Child taps **Done**
2. TaskInstance получает статус `under_review`
3. Задача:
   - исчезает из вкладки Today / Anytime / Repeats
   - появляется во вкладке Review

**Result:**
- ожидает решения родителя
- деньги пока не начисляются

---

### UC-CHILD-TASK-02: Mark task as not done

**Description:**  
Ребёнок отказывается от выполнения задачи.

**Flow:**
1. Child taps **I can’t**
2. TaskInstance получает статус `declined`

**Result:**
- задача исчезает из вкладки Today / Anytime / Repeats
- задача **сразу появляется во вкладке History**
- оплата не производится

---

### UC-CHILD-TASK-03: Request new task

**Description:**  
Ребёнок отправляет родителю запрос на создание новой задачи.

**Flow:**
1. Child taps **Ask for a new task**
2. Заполняет форму запроса
3. Запрос отправляется родителю

**Rules:**
- запрос **не отображается** ни в одной вкладке Tasks
- Review содержит **только выполненные задачи**

---

### UC-CHILD-TASK-04: Automatic decline (missed deadline)

**Description:**  
Задача автоматически отклоняется, если не была выполнена в нужную дату.

**Flow:**
1. Дата задачи проходит
2. TaskInstance получает статус `auto_declined`

**Result:**
- задача исчезает из вкладки Today / Repeats
- задача появляется во вкладке History
- оплата не производится

---

## Card Display Rules

- Anytime tasks → показывается **время создания**
- Все остальные → показывается **дата выполнения или дата instance**

---

## Status Logic Summary

| Status | Visible in |
|------|------------|
| active | Today / Anytime / Repeats |
| under_review | Review |
| done | History |
| declined | History |
| auto_declined | History |
| parent_declined | History |

---

## Notes for Backend

- Review = **только child-completed tasks**
- Decline со стороны ребёнка **минуя Review**
- Auto-decline срабатывает по cron / date check
- Repeat → всегда через TaskInstance
