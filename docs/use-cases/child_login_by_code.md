# Child Login by Code

## Цель
Обеспечить безопасную и простую авторизацию ребёнка в **детском приложении**, установленном на отдельном устройстве, без email и пароля.

Источник доверия — **родительский аккаунт**.

---

## Акторы
- **Parent** — владелец аккаунта, инициирует подключение
- **Child** — пользователь детского приложения
- **Backend (Auth + Core)**

---

## Preconditions
- Родитель зарегистрирован и залогинен
- У родителя создан хотя бы один `Child`
- Детское приложение установлено на устройстве ребёнка

---

## Основной Use Case

### UC-CHILD-AUTH-01: Login child by invite code

### Шаги

#### 1. Генерация кода (Parent app)
Parent выбирает:
> "Подключить устройство ребёнка"

Backend:
- генерирует одноразовый код
- задаёт TTL (например, 10 минут)

```json
InviteCode {
  id
  code: "483921"
  parentId
  childId        // invite всегда привязан к конкретному ребенку
  expiresAt
  used: false
}
```

---

#### 2. Экран входа (Child app)
Экран:
- Заголовок: «Введи код от родителя»
- Поле ввода кода
- CTA: «Продолжить»

---

#### 3. Отправка кода

```http
POST /auth/child/login-by-code
```
```json
{
  "code": "483921",
  "deviceFingerprint": "uuid-device-123"
}
```

---

#### 4. Проверка кода (Backend)
Backend:
- код существует
- не истёк
- не использован

Код **однозначно привязан к конкретному ребёнку**.

Backend сразу определяет `childId` из invite и **не возвращает список детей**."
}
```


#### 6. Завершение авторизации
Backend:
- связывает `childId` ↔ `deviceId`
- помечает код как `used`
- создаёт сессию ребёнка

```json
{
  "accessToken": "jwt",
  "refreshToken": "jwt",
  "child": {
    "id": "c1",
    "name": "Maksim"
  }
}
```

---

## Postconditions
- Устройство привязано к ребёнку
- Ребёнок залогинен
- Код больше невалиден

---

## Security rules
- Код одноразовый
- TTL
- Ограничение попыток
- Возможность revoke со стороны родителя

---

## Edge cases

| Ситуация | Поведение |
|--------|----------|
| Код истёк | Сообщение + кнопка «Запросить новый код» |
| Код использован | Ошибка + support |
| У родителя несколько детей | Экран выбора |
| Устройство утеряно | Родитель отзывает доступ |

---

## Почему без email/пароля
- ребёнку нельзя email
- проще UX
- меньше рисков

---

## Связанные Use Cases
- Parent creates child
- Parent revoke child device
- Child set PIN / biometrics

---

## Следующие шаги
- Child PIN setup
- Refresh token strategy
- Parental controls

## Next Screens
- Onbording (Child) 